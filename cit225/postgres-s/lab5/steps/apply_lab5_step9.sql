-- ------------------------------------------------------------------
--  Program Name:   apply_lab5_step9.sql
--  Lab Assignment: N/A
--  Program Author: Michael McLaughlin
--  Creation Date:  27-Aug-2020
-- ------------------------------------------------------------------
--  Change Log:
-- ------------------------------------------------------------------
--  Change Date    Change Reason
-- -------------  ---------------------------------------------------
--  
-- ------------------------------------------------------------------
--
-- ------------------------------------------------------------------
-- Instructions:
-- ------------------------------------------------------------------
-- You first connect to the Postgres database with this syntax:
--
--   psql -U student -d videodb -W
--
-- Then, you call this script with the following syntax:
--
--   psql> \i apply_lab5_step9.sql
--
-- ------------------------------------------------------------------

-- ------------------------------------------------------------------
--  Enter the Task #1.
-- ------------------------------------------------------------------

UPDATE item i
SET    i.item_rating = 'PG-13'
WHERE  i.item_rating = 'PG13';

-- ------------------------------------------------------------------
--  Enter the Task #2.
-- ------------------------------------------------------------------

\o ../log/seed_rating.sql \i ../tools/seed_rating.sql

-- ------------------------------------------------------------------
--  Enter the Task #3.
-- ------------------------------------------------------------------

ALTER TABLE item 
  ADD (rating_id INT);

-- ------------------------------------------------------------------
--  Enter the Task #4.
-- ------------------------------------------------------------------

UPDATE item i
SET    i.rating_id =
WHERE  EXISTS
         (SELECT NULL
          FROM   rental r
	  WHERE  r.rating = i.item_rating
          OR     r.description = i.item_rating);


UPDATE item i
SET    i.item_rating = 'PG-13'
WHERE  i.item_rating = 'PG13';

-- ------------------------------------------------------------------
--  Enter the Task #3.
-- ------------------------------------------------------------------

UPDATE item i
SET    i.item_rating = 'PG-13'
WHERE  i.item_rating = 'PG13';

-- ------------------------------------------------------------------
